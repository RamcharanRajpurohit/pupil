# AI-Generated Tests Integration

This document describes the integration of AI-generated tests from the pupil-agents API into the client application.

## Overview

The test section fetches and displays assessments generated by the pupil-agents AI system. Users can view test details and take tests with automatic answer tracking.

## Features

### 1. Tests Overview Page (`/tests`)
- Displays all AI-generated assessments from the teacher endpoint
- Shows test statistics: total tests, completed tests, failed tests
- Filters: All, Completed, Failed
- Each test card shows:
  - Test name and subject
  - Status badge (completed/failed/pending)
  - Difficulty level
  - Number of questions
  - Estimated time
  - Total marks
  - Creation date
  - Topics covered
  - "Start Test" button (only for completed tests)

### 2. Test Detail Page (`/tests/:assessmentId`)
- **Test Overview Screen**:
  - Test name and subject
  - Key statistics (questions, time, marks, type)
  - Topics covered
  - Instructions
  - "Start Test" button

- **Test Taking Interface**:
  - Question navigation with progress bar
  - Question counter (e.g., "Question 1 of 20")
  - Support for multiple question types:
    - MCQ (single correct answer)
    - MCQ (multiple correct answers)
    - Integer type questions
    - Descriptive questions
  - Auto-save answers
  - Show/hide explanations for each question
  - Question number navigation
  - Previous/Next buttons
  - Submit test button

## API Endpoints Used

### 1. Get Teacher Assessments
```
GET /api/assessments/teacher?limit=50&offset=0
```

**Response Format:**
```typescript
{
  "assessments": [
    {
      "id": "string",
      "job_id": "string",
      "status": "completed" | "failed" | "pending",
      "created_at": "string",
      "test_name": "string",
      "subject": "string",
      "test_type": "string",
      "difficulty": "easy" | "medium" | "hard",
      "topics": ["string"],
      "number_of_questions": number,
      "estimated_time_minutes": number,
      "total_marks": number
    }
  ],
  "count": number,
  "limit": number,
  "offset": number,
  "type": "teacher"
}
```

### 2. Get Assessment by ID
```
GET /api/assessments/:assessmentId
```

**Response Format:**
```typescript
{
  "_id": "string",
  "job_id": "string",
  "status": "completed",
  "created_at": "string",
  "question_ids": ["string"],
  "request_params": object,
  "questions": [
    {
      "_id": "string",
      "questionText": "string",
      "questionType": "MCQ" | "Integer" | "Descriptive",
      "origin": "string",
      "options": [
        {
          "key": "string",
          "text": "string"
        }
      ],
      "answer": {
        "key": "string" | ["string"],
        "explanation": "string"
      },
      "difficulty": "easy" | "medium" | "hard",
      "grade": "string",
      "topics": ["string"],
      "learningOutcomes": ["string"],
      "statistics": object
    }
  ]
}
```

## Configuration

### Environment Variables

Create a `.env` file in the `client` folder:

```env
VITE_PUPIL_AGENTS_API=http://localhost:8080
```

For production, update to your deployed pupil-agents API URL.

### CORS Configuration

Ensure your pupil-agents API allows requests from your frontend domain. Update the CORS configuration in `pupiltree-agents-develop/main.py`:

```python
origins = [
    "http://localhost:5173",  # Vite dev server
    "http://localhost:3000",  # Alternative dev port
    "https://your-frontend-domain.com"  # Production domain
]
```

## File Structure

```
client/src/
├── pages/
│   ├── TestsPage.tsx           # Tests overview page
│   └── TestDetailPage.tsx      # Individual test page
├── types/
│   └── index.ts                # Added AI assessment types
├── services/
│   └── api.ts                  # Added API functions
└── App.tsx                     # Added routes
```

## New TypeScript Types

```typescript
export interface AIAssessment {
  id: string;
  job_id: string;
  status: 'completed' | 'failed' | 'pending';
  created_at: string | null;
  test_name: string | null;
  subject: string | null;
  test_type: string | null;
  difficulty: 'easy' | 'medium' | 'hard' | null;
  topics: string[] | null;
  number_of_questions: number | null;
  estimated_time_minutes: number | null;
  total_marks: number | null;
}

export interface AIAssessmentDetail extends AIAssessment {
  question_ids: string[];
  request_params: any;
  questions: AIQuestion[];
}

export interface AIQuestion {
  _id: string;
  questionText: string;
  questionType: 'MCQ' | 'Integer' | 'Descriptive';
  options: AIQuestionOption[];
  answer: AIQuestionAnswer;
  difficulty: 'easy' | 'medium' | 'hard';
  // ... more fields
}
```

## API Service Functions

```typescript
// In services/api.ts

// Get all teacher assessments
async getTeacherAssessments(limit: number = 50, offset: number = 0)

// Get assessment details by ID
async getAIAssessmentById(assessmentId: string)

// Get student assessments (available but not used yet)
async getStudentAssessments(limit: number = 50, offset: number = 0)
```

## Usage

### Navigate to Tests Page
```typescript
navigate('/tests')
```

### View Test Details
```typescript
navigate(`/tests/${assessmentId}`)
```

## Running the Application

1. **Start the pupil-agents API:**
```bash
cd pupiltree-agents-develop
# Make sure MongoDB is running
python main.py
```

2. **Start the client:**
```bash
cd client
npm run dev
```

3. **Access the application:**
- Navigate to `http://localhost:5173` (or your configured port)
- Go to `/tests` to see all AI-generated tests
- Click "Start Test" on any completed test to take it

## Features in Development

- Submit test answers to backend
- View test results and analytics
- Test history and performance tracking
- Student-specific assessments
- Real-time test timer
- Auto-submit on time expiry

## Troubleshooting

### API Connection Issues
- Verify `VITE_PUPIL_AGENTS_API` is set correctly in `.env`
- Check that pupil-agents API is running
- Verify CORS settings in pupil-agents API
- Check browser console for error messages

### Failed Tests Not Loading
- Failed tests have null values for most fields
- The UI handles this gracefully by showing "N/A"
- Only completed tests can be started

### Questions Not Displaying
- Ensure MongoDB is running with the correct data
- Check that the assessment has `questions` array populated
- Verify API response structure matches TypeScript types

## Contributing

When adding new features:
1. Update TypeScript types in `types/index.ts`
2. Add API functions in `services/api.ts`
3. Create/update components and pages
4. Update this documentation

## Notes

- The current implementation shows explanations but doesn't evaluate answers
- Test submission is a placeholder (alerts "demo" message)
- Student assessments endpoint is available but not integrated yet
- Consider adding authentication/authorization for production use
